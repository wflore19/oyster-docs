"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5381],{8778:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(4848),i=n(8453);const o={sidebar_position:2},a="How to Implement a Database Migration",s={id:"guides/how-to-implement-a-database-migration",title:"How to Implement a Database Migration",description:"Context",source:"@site/docs/guides/how-to-implement-a-database-migration.md",sourceDirName:"guides",slug:"/guides/how-to-implement-a-database-migration",permalink:"/oyster-docs/docs/guides/how-to-implement-a-database-migration",draft:!1,unlisted:!1,editUrl:"https://github.com/colorstackorg/oyster/tree/main/docs/docs/guides/how-to-implement-a-database-migration.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Create a Pull Request",permalink:"/oyster-docs/docs/github guides/create-pull-request"},next:{title:"How to Enable Integrations",permalink:"/oyster-docs/docs/guides/how-to-enable-integrations"}},c={},l=[{value:"Context",id:"context",level:2},{value:"Where Our Migrations Live",id:"where-our-migrations-live",level:2},{value:"How to Run Migrations",id:"how-to-run-migrations",level:2},{value:"How to Create a Migration",id:"how-to-create-a-migration",level:2},{value:"Common Errors",id:"common-errors",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"how-to-implement-a-database-migration",children:"How to Implement a Database Migration"})}),"\n",(0,r.jsx)(t.h2,{id:"context",children:"Context"}),"\n",(0,r.jsxs)(t.p,{children:["We are using ",(0,r.jsx)(t.a,{href:"https://www.postgresql.org",children:"PostgreSQL"})," as our primary database,\nand ",(0,r.jsx)(t.a,{href:"https://kysely.dev",children:"Kysely"}),' as our query builder to communicate with our\ndatabase. Kysely also supports classic "up"/"down" migrations.']}),"\n",(0,r.jsx)(t.h2,{id:"where-our-migrations-live",children:"Where Our Migrations Live"}),"\n",(0,r.jsxs)(t.p,{children:["All of our database migrations live in our ",(0,r.jsx)(t.code,{children:"@oyster/db"})," package, specifically\n",(0,r.jsx)(t.a,{href:"https://github.com/colorstackorg/oyster/tree/main/packages/db/src/migrations",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"how-to-run-migrations",children:"How to Run Migrations"}),"\n",(0,r.jsxs)(t.p,{children:["We have a\n",(0,r.jsx)(t.a,{href:"https://github.com/colorstackorg/oyster/blob/main/packages/db/src/scripts/migrate.ts",children:(0,r.jsx)(t.code,{children:"migrate"})}),"\nscript, which effectively executes any migrations that haven't been executed\nyet. To run this script:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"yarn db:migrate\n"})}),"\n",(0,r.jsx)(t.p,{children:"Note: Kysely automatically knows which migrations have been executed or not\nbecause it has its own internal table within our database where it stores the\nmigrations it's executed (and when it executed them). You'll be able to verify\nthat a migration has run successfully if it shows up in this query:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"select * from kysely_migrations;\n"})}),"\n",(0,r.jsx)(t.h2,{id:"how-to-create-a-migration",children:"How to Create a Migration"}),"\n",(0,r.jsx)(t.p,{children:"To create a migration file, run:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"yarn db:migration:create\n"})}),"\n",(0,r.jsx)(t.p,{children:"In the prompt, you'll need to enter a name for your migration, and then your\nmigration file will be created! Boom! \ud83d\udca5"}),"\n",(0,r.jsx)(t.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"Error: corrupted migrations: previously executed migration <SOME_MIGRATION_NAME> is missing.\n"})}),"\n",(0,r.jsx)(t.p,{children:"The easiest way to fix this is to re-setup your database by running:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"yarn dx:nuke\nyarn dx:up\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>s});var r=n(6540);const i={},o=r.createContext(i);function a(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);